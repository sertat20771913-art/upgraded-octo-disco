<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü–æ–≥–æ–¥–∞ iOS6</title>
<style>
/* –®—Ä–∏—Ñ—Ç—ã –∏ –æ–±—â–∏–π —Å—Ç–∏–ª—å iOS6 */
body{margin:0;font-family:"Helvetica Neue", Helvetica, Arial,sans-serif;background:#0b2b4a;color:white;}
#app{display:flex;flex-direction:column;height:100vh;}
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:linear-gradient(#d8d8d8,#b5b5b5);color:#000;font-weight:600;}
.top-bar button{border:none;border-radius:6px;padding:6px 10px;background:#007aff;color:white;cursor:pointer;font-size:13px;}
.top-bar input{border:1px solid #ccc;border-radius:6px;padding:4px 6px;width:120px;}
.main{flex:1;display:flex;flex-direction:column;}
.hero{position:relative;flex:0 0 40%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;}
.hero .city{font-size:22px;font-weight:600;margin-bottom:4px;}
.hero .temp{font-size:72px;font-weight:200;margin:0;}
.hero .desc{font-size:16px;opacity:0.9;margin-top:4px;}
.bg-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;transition:background 0.3s;border-radius:0;}
.forecast{flex:1;overflow:auto;padding:8px;}
.forecast table{width:100%;border-collapse:collapse;}
.forecast td{padding:8px;color:white;}
.day{width:40%;font-weight:600;}
.temps{width:40%;text-align:center;}
.icon{width:20%;text-align:right;}
.loader{text-align:center;padding:20px;}
img.weather-icon{width:24px;height:24px;vertical-align:middle;}
</style>
</head>
<body>
<div id="app">
  <div class="top-bar">
    <button id="btn-loc">üìç</button>
    <div>–ü–æ–≥–æ–¥–∞</div>
    <input id="inputCity" placeholder="–ì–æ—Ä–æ–¥ (Enter)">
  </div>
  <div class="main">
    <div class="hero">
      <div class="bg-layer" id="bg"></div>
      <div class="city" id="city">‚Äî</div>
      <div class="temp" id="temp">--¬∞</div>
      <div class="desc" id="desc">‚Äî</div>
    </div>
    <div class="forecast">
      <div class="loader" id="loader">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <table id="forecastTable"></table>
    </div>
  </div>
</div>

<script>
// --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Open-Meteo ---
const GEO_API='https://geocoding-api.open-meteo.com/v1/search?name=';
const FORECAST_API='https://api.open-meteo.com/v1/forecast';

const cityEl=document.getElementById('city');
const tempEl=document.getElementById('temp');
const descEl=document.getElementById('desc');
const bgEl=document.getElementById('bg');
const loader=document.getElementById('loader');
const tableEl=document.getElementById('forecastTable');
const inputCity=document.getElementById('inputCity');
const btnLoc=document.getElementById('btn-loc');

inputCity.addEventListener('keydown',e=>{if(e.key==='Enter'){fetchByCity(inputCity.value)}})
btnLoc.addEventListener('click',()=>{if(navigator.geolocation){loader.textContent='–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è‚Ä¶';navigator.geolocation.getCurrentPosition(p=>{fetchByCoords(p.coords.latitude,p.coords.longitude)},()=>{loader.textContent='–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'})}})

fetchByCity('Minsk');

async function fetchByCity(name){
loader.textContent='–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞‚Ä¶';loader.style.display='block';
try{
const res=await fetch(GEO_API+encodeURIComponent(name));
const data=await res.json();
const first=data.results && data.results[0];
if(!first) throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
fetchForecast(first.latitude,first.longitude,first.name+(first.country?', '+first.country:''));
}catch(e){loader.textContent='–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω';tableEl.innerHTML='';}
}

async function fetchByCoords(lat,lon){fetchForecast(lat,lon,'‚Äî')}

async function fetchForecast(lat,lon,prettyName){
loader.textContent='–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞‚Ä¶';loader.style.display='block';
tableEl.innerHTML='';
try{
const params=new URLSearchParams({latitude:lat,longitude:lon,current_weather:'true',daily:'temperature_2m_max,temperature_2m_min,weathercode',timezone:'auto'});
const res=await fetch(`${FORECAST_API}?${params.toString()}`);
const data=await res.json();
renderData(data,prettyName);
}catch(e){loader.textContent='–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';console.error(e);}
}

function renderData(data,forcedName){
loader.style.display='none';
const cur=data.current_weather;
cityEl.textContent=forcedName||'‚Äî';
tempEl.textContent=Math.round(cur.temperature)+'¬∞';
descEl.textContent=codeToText(cur.weathercode);
setBG(cur.weathercode);
buildTable(data.daily);
}

function buildTable(daily){
tableEl.innerHTML='';
const dates=daily.time||[],maxs=daily.temperature_2m_max||[],mins=daily.temperature_2m_min||[],codes=daily.weathercode||[];
for(let i=0;i<Math.min(7,dates.length);i++){
const tr=document.createElement('tr');
const tdDay=document.createElement('td');tdDay.className='day';tdDay.textContent=formatDay(dates[i]);tr.appendChild(tdDay);
const tdTemp=document.createElement('td');tdTemp.className='temps';tdTemp.innerHTML=`<b>${Math.round(maxs[i])}¬∞</b>/<small>${Math.round(mins[i])}¬∞</small>`;tr.appendChild(tdTemp);
const tdIcon=document.createElement('td');tdIcon.className='icon';tdIcon.innerHTML=iconBase64(codes[i]);tr.appendChild(tdIcon);
tableEl.appendChild(tr);
}
}

function formatDay(iso){const d=new Date(iso+'T00:00:00');return d.toLocaleDateString('ru-RU',{weekday:'short'})}

function codeToText(code){
const map={0:'–Ø—Å–Ω–æ',1:'–ß–∞—Å—Ç–∏—á–Ω–æ —è—Å–Ω–æ',2:'–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å',3:'–ü–∞—Å–º—É—Ä–Ω–æ',45:'–¢—É–º–∞–Ω',48:'–¢—É–º–∞–Ω',51:'–ú–æ—Ä–æ—Å—å',53:'–ú–æ—Ä–æ—Å—å',55:'–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å',61:'–î–æ–∂–¥—å –Ω–µ–±–æ–ª—å—à–æ–π',63:'–î–æ–∂–¥—å',65:'–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å',66:'–î–æ–∂–¥—å (–ª–µ–¥—è–Ω–æ–π)',67:'–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å (–ª–µ–¥—è–Ω–æ–π)',71:'–°–Ω–µ–≥',73:'–°–Ω–µ–≥',75:'–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥',77:'–ì—Ä–∞–¥',80:'–õ–∏–≤–Ω–∏',81:'–õ–∏–≤–Ω–∏ —Å–∏–ª—å–Ω—ã–µ',82:'–õ–∏–≤–Ω–∏ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ',85:'–°–Ω–µ–≥',86:'–°–Ω–µ–≥ —Å–∏–ª—å–Ω—ã–π',95:'–ì—Ä–æ–∑–∞',96:'–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º',99:'–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º'};
return map[code]||'‚Äî';
}

function setBG(code){
let g='linear-gradient(#4aa3ff,#0b2b4a)';
if([1,2,3,45,48].includes(code)) g='linear-gradient(#9fb7d8,#415a73)';
if([51,53,55,61,63,65,80,81,82].includes(code)) g='linear-gradient(#6b93b5,#243b4b)';
if([71,73,75,85,86,77].includes(code)) g='linear-gradient(#dbeefc,#6f8fa7)';
if([95,96,99].includes(code)) g='linear-gradient(#6b6f74,#1b2328)';
bgEl.style.background=g;
}

// --- –ò–∫–æ–Ω–∫–∏ –≤ Base64 –¥–ª—è iOS6 ---
function iconBase64(code){
if(code===0) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="sun"/>';
if([1,2].includes(code)) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="partly_cloudy"/>';
if([3,45,48].includes(code)) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="cloudy"/>';
if([51,53,55,61,63,65,80,81,82].includes(code)) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="rain"/>';
if([71,73,75,85,86,77].includes(code)) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="snow"/>';
if([95,96,99].includes(code)) return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="storm"/>';
return'<img class="weather-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAA..." alt="default"/>';
}
</script>
</body>
</html>