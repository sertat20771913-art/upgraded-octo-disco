<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AhhWeather ‚Äî –†–µ–∞–ª—å–Ω–∞—è –ø–æ–≥–æ–¥–∞</title>
<style>
  :root {
    --accent: #00bfff;
    --glass: rgba(255,255,255,0.1);
    --blur: 18px;
    --text: #fff;
    --bg: linear-gradient(to bottom, #1e3c72, #2a5298);
  }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    min-height: 100vh;
    overflow-x: hidden;
    transition: background 0.8s ease, color 0.8s ease;
  }

  .container {
    margin-top: 60px;
    width: 90%;
    max-width: 600px;
    backdrop-filter: blur(var(--blur));
    background: var(--glass);
    border-radius: 30px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    padding: 40px 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  h1 {
    margin-top: 0;
    font-size: 32px;
    letter-spacing: 1px;
  }

  input, button {
    padding: 12px 18px;
    font-size: 18px;
    border-radius: 10px;
    border: none;
    outline: none;
    margin: 10px;
  }

  input {
    width: 220px;
    background: rgba(255,255,255,0.2);
    color: #fff;
  }

  button {
    background: var(--accent);
    color: #fff;
    cursor: pointer;
    transition: transform 0.3s, background 0.3s;
  }

  button:hover { transform: scale(1.05); background: #0099ff; }

  .weather-box {
    margin-top: 20px;
  }

  .city {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .desc { font-size: 22px; margin-bottom: 20px; }

  .gauge-container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
  }

  .gauge {
    width: 160px;
    height: 80px;
    background: rgba(255,255,255,0.1);
    border-radius: 160px 160px 0 0;
    position: relative;
    overflow: hidden;
    margin: 20px;
  }

  .needle {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 4px;
    height: 80px;
    background: var(--accent);
    transform-origin: bottom;
    transform: rotate(0deg);
    transition: transform 1s ease-out;
  }

  .gauge-label {
    text-align: center;
    font-size: 18px;
    margin-top: -10px;
  }

  /* –¢–µ–º—ã */
  body.light {
    --bg: linear-gradient(to bottom, #74ebd5, #ACB6E5);
    --text: #000;
    --glass: rgba(255,255,255,0.4);
    --accent: #0077ff;
  }

  .theme-toggle {
    position: fixed;
    top: 15px;
    right: 15px;
    font-size: 26px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    width: 52px;
    height: 52px;
    border: none;
    backdrop-filter: blur(10px);
    cursor: pointer;
    color: var(--text);
    transition: all 0.4s;
    z-index: 10;
  }

  .theme-toggle:hover { transform: rotate(20deg); }

  /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
  .cloud, .rain, .flash {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }

  .cloud { 
    background: url('https://i.ibb.co/xsPcsMn/clouds.png') repeat-x;
    animation: clouds 60s linear infinite;
    opacity: 0.3;
  }

  .rain {
    display: none;
    background: repeating-linear-gradient(to bottom, rgba(255,255,255,0.3) 0, rgba(255,255,255,0.3) 2px, transparent 2px, transparent 4px);
    animation: rain 0.3s linear infinite;
  }

  .flash {
    display: none;
    background: rgba(255,255,255,0.6);
    animation: flash 0.5s ease-in-out;
  }

  @keyframes clouds { from { background-position-x: 0; } to { background-position-x: -1000px; } }
  @keyframes rain { to { background-position-y: 10px; } }
  @keyframes flash {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
  }
</style>
</head>
<body class="dark">
  <button class="theme-toggle">‚òÄÔ∏è</button>

  <div class="container">
    <h1>AhhWeather</h1>
    <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥..." />
    <button id="getWeatherBtn">–ü–æ–∫–∞–∑–∞—Ç—å</button>

    <div class="weather-box">
      <div class="city">‚Äî</div>
      <div class="temp" style="font-size:60px;">--¬∞C</div>
      <div class="desc">‚Äî</div>
      <div class="gauge-container">
        <div>
          <div class="gauge tempGauge"><div class="needle"></div></div>
          <div class="gauge-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
        </div>
        <div>
          <div class="gauge windGauge"><div class="needle"></div></div>
          <div class="gauge-label">–í–µ—Ç–µ—Ä</div>
        </div>
        <div>
          <div class="gauge humidityGauge"><div class="needle"></div></div>
          <div class="gauge-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
        </div>
      </div>
    </div>

    <div class="cloud"></div>
    <div class="rain"></div>
    <div class="flash"></div>
  </div>

  <script>
    const descText = {
      0: "–Ø—Å–Ω–æ", 1: "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ", 2: "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å", 3: "–ü–∞—Å–º—É—Ä–Ω–æ",
      45: "–¢—É–º–∞–Ω", 48: "–ò–Ω–µ–π", 51: "–ú–æ—Ä–æ—Å—å", 61: "–î–æ–∂–¥—å", 80: "–õ–∏–≤–µ–Ω—å", 95: "–ì—Ä–æ–∑–∞"
    };

    const getWeather = async () => {
      const city = document.getElementById("cityInput").value.trim();
      const cityEl = document.querySelector(".city");
      const tempEl = document.querySelector(".temp");
      const descEl = document.querySelector(".desc");
      const tempNeedle = document.querySelector(".tempGauge .needle");
      const windNeedle = document.querySelector(".windGauge .needle");
      const humidityNeedle = document.querySelector(".humidityGauge .needle");
      const rain = document.querySelector(".rain");
      const flash = document.querySelector(".flash");
      const cloud = document.querySelector(".cloud");

      if (!city) { cityEl.textContent = "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥"; return; }

      try {
        const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=ru`);
        const geoData = await geo.json();
        if (!geoData.results || geoData.results.length === 0) {
          cityEl.textContent = "–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω";
          return;
        }

        const { latitude, longitude, name, country } = geoData.results[0];
        const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
        const wData = await w.json();
        const weather = wData.current_weather;

        const desc = descText[weather.weathercode] || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
        cityEl.textContent = `${name}, ${country}`;
        tempEl.textContent = `${weather.temperature.toFixed(1)}¬∞C`;
        descEl.textContent = desc;

        const angle = ((weather.temperature - 15) / (40 - (-25))) * 180 - 90;
        tempNeedle.style.transform = `rotate(${Math.min(90, Math.max(-90, angle))}deg)`;

        const windAngle = Math.min(90, Math.max(-90, (weather.windspeed - 10) * 3));
        windNeedle.style.transform = `rotate(${windAngle}deg)`;

        humidityNeedle.style.transform = `rotate(${Math.random()*180-90}deg)`; // —Å–ª—É—á–∞–π–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

        // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        rain.style.display = desc.includes("–¥–æ–∂–¥") || desc.includes("–ª–∏–≤–µ–Ω—å") ? "block" : "none";
        cloud.style.opacity = desc.includes("–æ–±–ª–∞") || desc.includes("–ø–∞—Å–º—É—Ä") ? "0.5" : "0.3";
        if (desc.includes("–≥—Ä–æ–∑–∞")) {
          flash.style.display = "block";
          setTimeout(()=> flash.style.display = "none", 400);
        }
      } catch {
        cityEl.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
      }
    };

    document.getElementById("getWeatherBtn").addEventListener("click", getWeather);

    const toggle = document.querySelector(".theme-toggle");
    const body = document.body;
    function setTheme(mode){
      if(mode==="light"){body.classList.add("light");toggle.textContent="üåô";localStorage.setItem("theme","light");}
      else{body.classList.remove("light");toggle.textContent="‚òÄÔ∏è";localStorage.setItem("theme","dark");}
    }
    toggle.addEventListener("click",()=>setTheme(localStorage.getItem("theme")==="dark"?"light":"dark"));
    setTheme(localStorage.getItem("theme")||"dark");
  </script>
</body>
</html>