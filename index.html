<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AhhWeather — Жидкое стекло</title>
<style>
  :root {
    --glass-bg: rgba(255,255,255,0.05);
    --glass-border: rgba(255,255,255,0.2);
    --accent: #4fb3ff;
    --text-light: #fff;
    --text-dark: #222;
    --bg-day: linear-gradient(to bottom, #74ebd5, #ACB6E5);
    --bg-night: linear-gradient(to bottom, #07121a, #0b1720);
  }

  html, body {
    margin:0; padding:0; height:100%; width:100%;
    font-family: sans-serif; overflow:hidden;
    background: var(--bg-night);
    color: var(--text-light);
  }

  body.day { background: var(--bg-day); color: var(--text-dark); }

  .app { position:relative; width:100%; height:100%; }
  canvas { position:absolute; inset:0; width:100%; height:100%; display:block; }

  /* Жидкое стекло */
  .panel, .gauge-wrap {
    position:absolute; backdrop-filter: blur(12px) saturate(150%);
    background: rgba(255,255,255,0.05); border-radius:16px; border:1px solid var(--glass-border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding:16px;
    color: inherit; transition: all 0.3s;
  }

  .gauge-wrap { top:50%; left:50%; transform:translate(-50%,-50%); width:380px; max-width:90%; z-index:50; }
  .temp-center { text-align:center; font-size:40px; font-weight:800; margin-top:-10px; }
  .weather-label { text-align:center; font-size:16px; margin-top:6px; }

  .panel { bottom:20px; left:50%; transform:translateX(-50%); width:92%; max-width:900px; display:flex; justify-content:space-around; flex-wrap:wrap; gap:12px; }

  /* Спидометр */
  svg { width:100%; height:220px; }

  .card { flex:1; min-width:100px; max-width:180px; background: rgba(255,255,255,0.03); border-radius:12px; padding:12px; text-align:center; cursor:pointer; user-select:none; transition: transform 0.2s; }
  .card:active { transform:translateY(2px); }
  .card .val { font-size:20px; font-weight:700; }
  .card .label { font-size:12px; color: rgba(255,255,255,0.7); }

  /* Controls */
  .controls { margin-top:12px; display:flex; gap:8px; justify-content:center; }
  input[type="text"] { padding:8px 12px; border-radius:10px; border:none; flex:1; background: rgba(255,255,255,0.05); color:inherit; }
  button { padding:8px 12px; border-radius:10px; border:none; background: var(--accent); color:#fff; cursor:pointer; }

</style>
</head>
<body>
<div class="app">
  <canvas id="sky"></canvas>
  <canvas id="clouds"></canvas>
  <canvas id="precip"></canvas>

  <div class="gauge-wrap">
    <svg viewBox="0 0 360 220">
      <defs>
        <linearGradient id="gGrad" x1="0" x2="1">
          <stop offset="0%" stop-color="#4fb3ff"/>
          <stop offset="50%" stop-color="#7ef0b8"/>
          <stop offset="100%" stop-color="#ff6b6b"/>
        </linearGradient>
      </defs>
      <g transform="translate(180,180)">
        <path id="arc-bg" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="18" stroke-linecap="round"></path>
        <path id="arc-fill" fill="none" stroke="url(#gGrad)" stroke-width="18" stroke-linecap="round"></path>
        <g id="ticks"></g>
        <g id="needleG" transform="rotate(0)">
          <line x1="0" y1="0" x2="0" y2="-88" stroke="#fff" stroke-width="3" stroke-linecap="round"></line>
          <circle r="6" fill="#fff"></circle>
        </g>
      </g>
    </svg>
    <div class="temp-center" id="tempCenter">15°C</div>
    <div class="weather-label" id="weatherLabel">Ясно</div>
  </div>

  <div class="panel">
    <div class="card" id="card-wind"><div class="val" id="val-wind">5 км/ч</div><div class="label">Ветер</div></div>
    <div class="card" id="card-humidity"><div class="val" id="val-humidity">45%</div><div class="label">Влажность</div></div>
    <div class="card" id="card-pressure"><div class="val" id="val-pressure">1012 hPa</div><div class="label">Давление</div></div>
  </div>

  <div class="controls">
    <input type="text" id="cityInput" placeholder="Введите город">
    <button id="btnFetch">Показать погоду</button>
  </div>
</div>

<script>
const tempCenter = document.getElementById("tempCenter");
const weatherLabel = document.getElementById("weatherLabel");
const valWind = document.getElementById("val-wind");
const valHumidity = document.getElementById("val-humidity");
const valPressure = document.getElementById("val-pressure");
const arcFill = document.getElementById("arc-fill");
const needleG = document.getElementById("needleG");
const ticksG = document.getElementById("ticks");

const minTemp = -25, maxTemp = 40;

function polarToCartesian(cx, cy, r, angleDeg){
  const rad = (angleDeg-90)*Math.PI/180;
  return {x: cx + r*Math.cos(rad), y: cy + r*Math.sin(rad)};
}

function describeArc(cx,cy,r,startAngle,endAngle){
  const start = polarToCartesian(cx,cy,r,endAngle);
  const end = polarToCartesian(cx,cy,r,startAngle);
  const largeArcFlag = endAngle - startAngle <= 180 ? "0":"1";
  return `M${start.x} ${start.y} A${r} ${r} 0 ${largeArcFlag} 0 ${end.x} ${end.y}`;
}

function mapTempToAngle(temp){
  const clamped = Math.max(minTemp,Math.min(maxTemp,temp));
  const ratio = (clamped-minTemp)/(maxTemp-minTemp);
  return -120 + ratio*240;
}

function renderTicks(){
  let html='';
  for(let i=0;i<=12;i++){
    const t=minTemp + i*(maxTemp-minTemp)/12;
    const angle = mapTempToAngle(t);
    const p1 = polarToCartesian(0,0,120,angle);
    const p2 = polarToCartesian(0,0,110,angle);
    html+=`<line x1="${p1.x}" y1="${p1.y}" x2="${p2.x}" y2="${p2.y}" stroke="rgba(255,255,255,0.1)" stroke-width="2"/>`;
    if(i%3===0){
      const l = polarToCartesian(0,0,95,angle);
      html+=`<text x="${l.x}" y="${l.y+4}" font-size="10" fill="#cfe9e5" text-anchor="middle">${Math.round(t)}</text>`;
    }
  }
  ticksG.innerHTML=html;
}

renderTicks();

function updateGauge(temp){
  const angle = mapTempToAngle(temp);
  arcFill.setAttribute('d',describeArc(0,0,120,-120,angle));
  needleG.setAttribute('transform',`rotate(${angle})`);
}

function setWeather(temp,label,wind,hum,press){
  tempCenter.textContent=temp+"°C";
  weatherLabel.textContent=label;
  valWind.textContent=wind+" км/ч";
  valHumidity.textContent=hum+"%";
  valPressure.textContent=press+" hPa";
  updateGauge(temp);
}

// Тестовые данные
setWeather(15,"Ясно",5,45,1012);

// Можно подключить Open-Meteo или вручную менять
document.getElementById("btnFetch").addEventListener("click",async()=>{
  const city = document.getElementById("cityInput").value.trim();
  if(!city) return alert("Введите город");

  try{
    const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=ru`);
    const geoData = await geo.json();
    if(!geoData.results || geoData.results.length===0) return alert("Город не найден");
    const {latitude,longitude,name,country} = geoData.results[0];

    const weather = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`).then(r=>r.json());
    const w = weather.current_weather;
    setWeather(Math.round(w.temperature), "Сейчас", Math.round(w.windspeed),0,0);
  }catch(e){ alert("Ошибка получения данных") }
});

// Тут можно добавить анимацию облаков, дождя, эффекты
</script>
</body>
</html>